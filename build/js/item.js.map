{"version":3,"sources":["app/js/item.js"],"names":[],"mappings":"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","file":"app/js/item.js","sourcesContent":["export default class Item{\n  constructor({sprites = {}, context = null, directions = ['right','top']}){\n    this.sprites = sprites;\n    this.context = context;\n    this.directions = directions;\n  }\n  \n  build(){\n    return Promise.all(Object.keys(this.sprites).map(key => {\n      let sprite = this.sprites[key];\n      sprite.build ? sprite.build() : Promise.all(Object.keys(sprite).map(direction => {\n        sprite[direction].build();\n      }));\n    })).then(() => this);\n  }\n  \n  get iterator(){ return function *({resolve,x=null, y=null, toX=null, toY=null, speed=0, dx=0, dy=0}){\n    this.x = x;\n    this.y = y;\n    while(!speed || (this.x !== toX && this.y !== toY)){\n      let delta = yield(null);\n      this.x = this.x + dx * delta;\n      this.y = this.y + dy * delta;\n      if(toX && toY){\n        this.x = (dx > 0 ? this.x > toX : this.x < toX ) ? toX : this.x;\n        this.y = (dy > 0 ? this.y > toY : this.y < toY ) ? toY : this.y;\n      }\n    }\n    resolve();\n  }}\n  \n  still({key = this.key, x = this.x, y = this.y}){\n    this.key = key;\n    this.animation = this.iterator({x:x, y:y});\n    this.sprite = this.sprites[key];\n    this.animation.next();\n    return this.sprite.run();\n  }\n  \n  move({key = this.key, fromX = this.x, fromY = this.y, toX, toY, speed = this.speed}){\n    return new Promise( resolve => {\n      let line = Math.pow(Math.pow(fromX - toX,2) + Math.pow(fromY - toY,2), 0.5);\n      let [dx, dy] = [(toX - fromX) / line * speed, (toY - fromY) / line * speed];\n      this.key = key;\n      this.speed = speed;\n      this.directions = [dx > 0 ? 'right' : 'left', dy > 0 ? 'bottom' : 'top'];\n      this.directions = Math.abs(dx) > Math.abs(dy) ? this.directions : this.directions.reverse();\n      this.animation = this.iterator({resolve: resolve, x:fromX, y:fromY, toX: toX, toY: toY, speed: speed, dx: dx, dy: dy});\n      this.sprite = this.directions.reduce((memo,dir) => !memo ? this.sprites[key][dir] : memo, null) || this.sprites[key]['other'] || this.sprites[key];\n      this.animation.next();\n      this.sprite.run();\n    });\n  }\n  \n  tick({delta, context = null}){\n    if(this.sprite && this.animation){\n      let next = this.animation.next(delta);\n      if(next.done){\n        this.animation = null;\n      }\n      this.sprite.tick({delta: delta, context: this.context, x: this.x, y: this.y}); \n    }\n  }\n  \n}"]}