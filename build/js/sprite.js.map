{"version":3,"sources":["app/js/sprite.js"],"names":[],"mappings":";;;mBAEqB,MAAM;;;;;;;;;;;AAAN,YAAM;AAEd,iBAFQ,MAAM,CAEb,IAAY,EAAC;2BAAb,IAAY,CAAX,KAAK;cAAL,KAAK,8BAAG,EAAE;;gCAFJ,MAAM;;AAGvB,cAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACnB,cAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;SAC5B;;qBALkB,MAAM;;iBAOpB,iBAAE;;;kCACiB,IAAI,CAAC,KAAK,CAAC,QAAQ;gBAApC,GAAG,mBAAH,GAAG;gBAAE,QAAQ,mBAAR,QAAQ;;AAClB,mBAAO,WAAW,CAAC,GAAG,CAAC,EAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAC,CAAC,CAC5C,IAAI,CAAC,UAAA,KAAK,EAAI;AACb,oBAAK,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;AACzB,oBAAK,MAAM,GAAG,MAAK,MAAM,IAAI,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG,EAAI;AAC3D,mBAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACxB,uBAAO,GAAG,CAAC;eACZ,CAAC,CAAC;aACJ,CAAC,CAAC,IAAI,CAAC;;aAAU,CAAC,CAAC;WACvB;;;iBASG,gBAAE;;;AACJ,mBAAO,IAAI,OAAO,CAAC,UAAA,OAAO,EAAI;AAC5B,qBAAK,SAAS,GAAG,OAAK,QAAQ,CAAC,EAAC,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;aACpD,CAAC,CAAC;WACJ;;;iBAEE,eAAE;AACH,gBAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAC,KAAK,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC;AAC5C,mBAAO,OAAO,CAAC,OAAO,EAAE,CAAC;WAC1B;;;iBAEG,gBAAE;AACJ,gBAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,gBAAI,CAAC,KAAK,GAAG,IAAI,CAAC;AAClB,mBAAO,OAAO,CAAC,OAAO,EAAE,CAAC;WAC1B;;;iBAEG,cAAC,KAAqC,EAAC;gBAArC,KAAK,GAAN,KAAqC,CAApC,KAAK;0BAAN,KAAqC,CAA7B,CAAC;gBAAD,CAAC,2BAAG,CAAC;0BAAb,KAAqC,CAAtB,CAAC;gBAAD,CAAC,2BAAG,CAAC;gCAApB,KAAqC,CAAf,OAAO;gBAAP,OAAO,iCAAG,IAAI;;AACvC,gBAAG,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,EAAC;AAC/B,kBAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC;AACvD,kBAAI,CAAC,SAAS,CAAC,QAAQ,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,IAAI,CAAC,CAAA,GAAI,KAAK,CAAC;;AAEjE,qBAAM,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAC;AACpE,oBAAI,CAAC,SAAS,CAAC,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;AAC/C,oBAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;AACjC,oBAAG,CAAC,IAAI,CAAC,IAAI,EAAC;AACZ,sBAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;iBACzB,MAAI;AACH,sBAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,sBAAI,CAAC,KAAK,GAAG,IAAI,CAAC;iBACnB;eACF;aACF;AACD,gBAAI,CAAC,IAAI,CAAC,CAAC,EAAC,CAAC,EAAC,OAAO,CAAC,CAAC;WACxB;;;iBAEG,cAAC,CAAC,EAAC,CAAC,EAAC,OAAO,EAAC;AACf,gBAAG,IAAI,CAAC,KAAK,IAAI,OAAO,EAAC;AACvB,qBAAO,CAAC,IAAI,EAAE,CAAC;AACf,kBAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAC;AAC7B,uBAAO,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;AAC3C,uBAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACrB,iBAAC,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;eAC9B;AACD,qBAAO,CAAC,SAAS,CACf,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,EAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,EAChF,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,GAAC,CAAC,EAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAC,CAAC,EAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CACzF,CAAC;AACF,qBAAO,CAAC,OAAO,EAAE,CAAC;aACnB;WACF;;;eAzDW,eAAE;AAAE,2CAAO,oBAAU,KAA+B;kBAA9B,OAAO,GAAR,KAA+B,CAA9B,OAAO;gCAAR,KAA+B,CAArB,KAAK;kBAAL,KAAK,+BAAG,CAAC;gCAAnB,KAA+B,CAAV,KAAK;kBAAL,KAAK,+BAAG,CAAC;kBACrD,CAAC;;;;AAAD,qBAAC,GAAC,KAAK;;;0BAAE,KAAK,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAA;;;;;;2BACvD,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;;;AADsB,qBAAC,EAAE;;;;;AAGpE,2BAAO,EAAE,CAAC;;;;;;;aACX,EAAA;WAAC;;;eAxBiB,MAAM;;;yBAAN,MAAM","file":"app/js/sprite.js","sourcesContent":["import spriteSheet from './sprite-sheet.js';\n\nexport default class Sprite{\n  \n  constructor({sheet = {}}){\n    this.sheet = sheet;\n    this.frames = sheet.frames;\n  }\n  \n  build(){\n    let {key, duration} = this.sheet.sequence;\n    return spriteSheet.get({path: this.sheet.name})\n      .then(sheet => {\n        this.image = sheet.image;\n        this.frames = this.frames || sheet.sequences[key].map(seq => {\n          seq.duration = duration;\n          return seq;\n        });\n      }).then(() => this);\n  }\n  \n  get iterator(){ return function*({resolve, times = 1, start = 0}){\n    for(let i=start; times === -1 || i < this.frames.length * times; i++){\n      yield(this.frames[i % this.frames.length]);\n    }\n    resolve();\n  }}\n  \n  loop(){\n    return new Promise(resolve => {\n      this.animation = this.iterator({resolve: resolve});\n    });\n  }\n  \n  run(){\n    this.animation = this.iterator({times: -1});\n    return Promise.resolve();\n  }\n  \n  stop(){\n    this.animation = null;\n    this.frame = null;\n    return Promise.resolve();\n  }\n   \n  tick({delta, x = 0, y = 0, context = null}){\n    if(this.animation && this.frames){\n      this.frame = this.frame || this.animation.next().value;\n      this.animation.progress = (this.animation.progress || 0) + delta;\n\n      while(this.animation && this.animation.progress > this.frame.duration){\n        this.animation.progress -= this.frame.duration;\n        let next = this.animation.next();\n        if(!next.done){\n          this.frame = next.value;\n        }else{\n          this.animation = null;\n          this.frame = null;\n        }\n      }\n    }\n    this.draw(x,y,context);\n  }\n  \n  draw(x,y,context){\n    if(this.frame && context){\n      context.save();\n      if(this.sheet.flipHorizontally){\n        context.translate(context.canvas.width, 0);\n        context.scale(-1, 1);\n        x = context.canvas.width - x;\n      }\n      context.drawImage(\n        this.image, this.frame.left, this.frame.top,  this.frame.width, this.frame.height,\n        (x - this.frame.width/2), (y - this.frame.height/2), this.frame.width, this.frame.height\n      );\n      context.restore();\n    }\n  }\n}"]}